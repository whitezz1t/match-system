<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>é€‰æ‰‹åˆ—è¡¨</title>
    <script>
        // æ£€æŸ¥ sessionStorage é‡Œæœ‰æ²¡æœ‰æˆ‘ä»¬çš„â€œé€šè¡Œè¯â€
        const user = sessionStorage.getItem('match_user');
        if (!user) {
            // å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥æŠŠäººè¸¢å›ç™»å½•é¡µ
            alert("æ‚¨å°šæœªç™»å½•ï¼Œè¯·å…ˆç™»å½•ï¼");
            window.location.href = 'login.html';
        }
    </script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; padding: 40px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f5f5f5; }

        .back-btn { display: inline-block; margin-bottom: 20px; text-decoration: none; color: #007bff; font-weight: bold; }
        .add-btn { float: right; background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <a href="menu.html" class="back-btn">â† è¿”å›ä¸»èœå•</a>
    <button class="add-btn" onclick="addPlayer()">+ æ·»åŠ æ–°é€‰æ‰‹</button>
    <h1>ğŸ‘¥ å‚èµ›é€‰æ‰‹åˆ—è¡¨</h1>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>å§“å</th>
            <th>å¤´åƒ</th>
        </tr>
        </thead>
        <tbody id="playerTableBody">
        </tbody>
    </table>
</div>

<script>
    // 1. é¡µé¢åŠ è½½æ—¶ï¼Œå»åç«¯æ‹¿æ•°æ®
    async function loadPlayers() {
        const response = await fetch('/api/players');
        const players = await response.json();

        const tbody = document.getElementById('playerTableBody');
        tbody.innerHTML = ''; // æ¸…ç©ºæ—§æ•°æ®

        players.forEach(p => {
            const row = `
                    <tr>
                        <td>${p.playerId}</td>
                        <td><strong>${p.name}</strong></td>
                        <td>${p.avatar ? '<img src="' + p.avatar + '" width="30">' : 'æš‚æ— '}</td>
                    </tr>
                `;
            tbody.innerHTML += row;
        });
    }

    // 2. ç®€å•çš„æ·»åŠ åŠŸèƒ½
    async function addPlayer() {
        const name = prompt("è¯·è¾“å…¥æ–°é€‰æ‰‹çš„åå­—ï¼š");
        if (name) {
            await fetch(`/api/players?name=${name}`, { method: 'POST' });
            loadPlayers(); // åˆ·æ–°åˆ—è¡¨
        }
    }

    // å¯åŠ¨åŠ è½½
    loadPlayers();
</script>
</body>
</html>