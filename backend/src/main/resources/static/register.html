<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ–°ç”¨æˆ·æ³¨å†Œ</title>
  <link rel="stylesheet" href="https://cdn.staticfile.org/element-plus/2.3.12/index.css" />
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      font-family: Arial, sans-serif;
    }
    .register-card { width: 400px; border-radius: 12px; background: rgba(255,255,255,0.98); }
    .header { text-align: center; margin-bottom: 20px; font-size: 22px; font-weight: bold; color: #303133; }
  </style>
</head>
<body>
<div id="app">
  <el-card class="register-card">
    <div class="header">ğŸš€ æ³¨å†Œæ–°è£åˆ¤è´¦å·</div>

    <el-form label-position="top" size="large">
      <el-form-item label="ç”¨æˆ·å">
        <el-input v-model="form.username" placeholder="è®¾ç½®æ‚¨çš„ç”¨æˆ·å" :prefix-icon="User"></el-input>
      </el-form-item>

      <el-form-item label="å¯†ç ">
        <el-input v-model="form.password" type="password" placeholder="è®¾ç½®å¯†ç " :prefix-icon="Lock" show-password></el-input>
      </el-form-item>

      <el-form-item label="ç¡®è®¤å¯†ç ">
        <el-input v-model="form.confirmPassword" type="password" placeholder="å†æ¬¡è¾“å…¥å¯†ç " :prefix-icon="Lock" show-password></el-input>
      </el-form-item>

      <el-button type="success" style="width: 100%; margin-top: 10px;" @click="handleRegister" :loading="loading" round>
        ç«‹å³æ³¨å†Œ
      </el-button>

      <div style="text-align: center; margin-top: 15px;">
        <el-link type="primary" href="login.html">å·²æœ‰è´¦å·ï¼Ÿè¿”å›ç™»å½•</el-link>
      </div>
    </el-form>
  </el-card>
</div>

<script src="https://cdn.staticfile.org/vue/3.3.4/vue.global.js"></script>
<script src="https://cdn.staticfile.org/element-plus/2.3.12/index.full.js"></script>
<script src="https://cdn.staticfile.org/element-plus-icons-vue/2.1.0/index.min.js"></script>

<script>
  const { createApp, reactive, ref } = Vue;
  const { User, Lock } = ElementPlusIconsVue;

  const app = createApp({
    setup() {
      const loading = ref(false);
      const form = reactive({ username: '', password: '', confirmPassword: '' });

      const handleRegister = async () => {
        if(!form.username || !form.password) {
          ElementPlus.ElMessage.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
          return;
        }
        if(form.password !== form.confirmPassword) {
          ElementPlus.ElMessage.error('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
          return;
        }

        loading.value = true;
        try {
          const response = await fetch(`/api/register?username=${form.username}&password=${form.password}`, { method: 'POST' });
          const result = await response.text();

          if (result === 'success') {
            ElementPlus.ElMessage.success('æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨è·³è½¬ç™»å½•é¡µ...');
            setTimeout(() => window.location.href = 'login.html', 1500);
          } else if (result === 'exist') {
            ElementPlus.ElMessage.warning('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·æ¢ä¸€ä¸ª');
          } else {
            ElementPlus.ElMessage.error('æ³¨å†Œå¤±è´¥');
          }
        } catch (e) {
          ElementPlus.ElMessage.error('ç½‘ç»œé”™è¯¯');
        } finally {
          loading.value = false;
        }
      };

      return { form, handleRegister, loading, User, Lock };
    }
  });

  app.use(ElementPlus);
  app.mount('#app');
</script>
</body>
</html>